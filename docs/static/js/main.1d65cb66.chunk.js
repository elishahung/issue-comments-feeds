(this["webpackJsonpissue-comments-feeds"]=this["webpackJsonpissue-comments-feeds"]||[]).push([[0],{18:function(e,t,n){e.exports=n(32)},23:function(e,t,n){},28:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n(0),o=n.n(r),i=n(7),c=n.n(i),s=(n(23),n(2)),u=(n(28),n(17)),l=n.n(u),m=n(5),d=n.n(m),f=n(8),h=n(4),p=Object(h.b)({name:"issues",initialState:[],reducers:{addIssues:function(e,t){return[].concat(Object(a.a)(e),Object(a.a)(t.payload))}}}),g=Object(h.b)({name:"comments",initialState:[],reducers:{addComments:function(e,t){return[].concat(Object(a.a)(e),Object(a.a)(t.payload))}}}),b=Object(h.b)({name:"ui",initialState:{repo:void 0,page:1,isFetching:!1,issueTitleTable:{}},reducers:{applyRepo:function(e,t){e.repo=t.payload},increPage:function(e){e.page=e.page+1},finishPage:function(e){e.page=-1},startFetching:function(e){e.isFetching=!0},finishFetching:function(e){e.isFetching=!1},addIssueTitleTable:function(e,t){e.issueTitleTable=Object(f.a)({},e,{},t.payload)}}}),v={ui:b.reducer,comments:g.reducer,issues:p.reducer},E=(n(30),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=new Headers;var r="https://api.github.com".concat(e,"?")+new URLSearchParams(t);return fetch(r,Object(f.a)({headers:a},n))}),j=function(e,t){var n=e.join("\r\n".concat("aaanewlineaaa","\r\n"));return E("/markdown",void 0,{method:"POST",body:JSON.stringify({mode:"gfm",context:t,text:n})}).then((function(e){return e&&e.text()})).then((function(e){var t=e.split("aaanewlineaaa");return t=t.map((function(e){return n="<br>",(t=e).startsWith(n)&&(t=t.substring(n.length)),t.endsWith(n)&&(t=t.substring(0,t.length-n.length)),t;var t,n}))}))},w=function(){return function(e,t){e(b.actions.startFetching());var n=t().ui.repo,a=t().ui.page;1===a&&e(function e(t){return function(n,a){var r=a().ui.repo,o=void 0;return E("/repos/".concat(r,"/issues"),{state:"all",per_page:100,page:t}).then((function(e){if(200===e.status)return e.json()})).then((function(e){if(e&&0!==e.length){o=e;var t=e.reduce((function(e,t){return e[t.url]={title:t.title,url:t.html_url},e}),{});n(b.actions.addIssueTitleTable(t));var a=o.map((function(e){return e.body}));return j(a,r)}})).then((function(a){a&&(o.forEach((function(e,t){e.body=a[t],e.moment=d()(e.created_at).unix()})),n(p.actions.addIssues(o)),n(e(t+1)))}))}}(1));var r=void 0;return E("/repos/".concat(n,"/issues/comments"),{sort:"updated",direction:"desc",per_page:20,page:a}).then((function(e){if(200===e.status)return e.json()})).then((function(t){if(console.log(),t&&0!==t.length){e(b.actions.increPage());var a=(r=t).map((function(e){return e.body}));return j(a,n)}e(b.actions.finishPage())})).then((function(t){t&&(r.forEach((function(e,n){e.body=t[n],e.moment=d()(e.updated_at).unix()})),e(g.actions.addComments(r))),e(b.actions.finishFetching())}))}},y=function(e){var t=e.issueUrl,n=Object(s.c)((function(e){return e.ui.issueTitleTable[t]})),a=t.split("/").pop(),r="";return n&&(a=n.title,r=n.url),o.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"issue-title"},"#",a)},O=function(e){var t,n=e.comment,a=d()(n.updated_at);t=(new d.a).diff(a,"days")<3?a.fromNow():a.format("[on ]D MMM");var r="title"in n?n.url:n.issue_url;return o.a.createElement("div",{className:"comment-feed"},o.a.createElement("div",{className:"meta"},o.a.createElement("img",{src:n.user.avatar_url,alt:"avatar"}),o.a.createElement("a",{href:n.user.html_url,target:"_blank",rel:"noopener noreferrer",className:"username"},n.user.login),o.a.createElement("span",{className:"commented"},"\xa0commented"),o.a.createElement("span",{className:"date"},"\xa0",t),o.a.createElement(y,{issueUrl:r})),o.a.createElement("div",{className:"markdown-body",dangerouslySetInnerHTML:{__html:n.body}}))},N=function(){var e=Object(s.c)((function(e){return e})),t=e.issues,n=e.comments,a=e.ui,r=Object(s.b)(),i=[];if(n.length>0){var c=t;-1!==a.page&&(c=t.filter((function(e){return e.moment>=n[n.length-1].moment}))),i=n.concat(c).sort((function(e,t){return t.moment-e.moment}))}return o.a.createElement(l.a,{className:"comment-feed-list",pageStart:0,loadMore:function(){return r(w())},hasMore:!a.isFetching&&-1!==a.page,threshold:1024,useWindow:!0},i.map((function(e){return o.a.createElement(O,{key:e.id,comment:e})})))},_=function(){var e=Object(s.c)((function(e){return e.ui.repo})),t=e&&"index.html"!==e;return o.a.createElement("div",{className:"App"},t?o.a.createElement(N,null):o.a.createElement("div",{className:"help"},"Please add ",o.a.createElement("span",{className:"hl"},"owner/repo")," at the end of url."))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(31);var T=n(6),k=[].concat(Object(a.a)(Object(h.c)()),[T.a,!1]).filter(Boolean),F=Object(h.a)({reducer:v,middleware:k});c.a.render(o.a.createElement(s.a,{store:F},o.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[18,1,2]]]);
//# sourceMappingURL=main.1d65cb66.chunk.js.map